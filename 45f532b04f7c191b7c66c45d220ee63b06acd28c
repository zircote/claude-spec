---
type: decisions
spec: arch-lifecycle-automation
timestamp: '2025-12-15T06:46:29.990956Z'
summary: Use PROGRESS.md as Single Source of Truth
phase: architecture
tags:
- arch-lifecycle-automation
- adr
- architecture
- ci-cd
---

## Context
Implementation state needs to be tracked across multiple documents (README.md, IMPLEMENTATION_PLAN.md, REQUIREMENTS.md, CHANGELOG.md). We need to decide where the authoritative state lives.

Options considered:
1. Distributed state: Each document owns its own state
2. Central state: One file is authoritative, others are derived
3. External state: JSON/database file separate from markdown

## Decision
Use a new `PROGRESS.md` file as the single source of truth for all implementation state. Other documents are synchronized from PROGRESS.md.

## Alternatives Considered
- Distributed state
- JSON/database file

---
type: decisions
spec: arch-lifecycle-automation
timestamp: '2025-12-15T06:46:53.672258Z'
summary: Hybrid Checkpoint System for Context Loading
phase: architecture
tags:
- arch-lifecycle-automation
- adr
- architecture
- ci-cd
---

## Context
When `/arch:i` starts, it needs to provide Claude with implementation context. We need to decide how much to load and how.

Options considered:
1. Full document load (all planning docs into context)
2. Condensed brief (summary only)
3. Progressive loading (current phase detail + overview)
4. Reference mode (lazy loading on demand)
5. Hybrid checkpoint (brief + persistent PROGRESS.md)

## Decision
Use Hybrid Checkpoint System: Load a condensed implementation brief at startup, maintain state in PROGRESS.md that persists across sessions.

## Alternatives Considered
- Full document load
- Condensed brief only
- Progressive loading
- Reference mode

---
type: decisions
spec: arch-lifecycle-automation
timestamp: '2025-12-15T06:46:53.761163Z'
summary: Auto-Detect Project from Branch Name
phase: architecture
tags:
- arch-lifecycle-automation
- adr
- architecture
- git
- ci-cd
---

## Context
When user runs `/arch:i`, we need to determine which architecture project to work on. Options:

1. Always require explicit project ID argument
2. Auto-detect from current git branch
3. Interactive selection from active projects
4. Combination with fallback chain

## Decision
Auto-detect project from current git branch name, with explicit argument as override and interactive selection as fallback for ambiguous cases.

Detection logic:
1. If explicit argument provided, use it
2. Parse current branch name (e.g., `fix/arch-commands` → `arch-commands`)
3. Search `docs/architecture/active/*/README.md` for matching slug
4. If multiple matches, prompt user to select
5. If no matches, provide helpful error

## Alternatives Considered
- Always require argument
- Interactive selection only

---
type: decisions
spec: arch-lifecycle-automation
timestamp: '2025-12-15T06:46:53.865584Z'
summary: Hierarchical Status Rollup
phase: architecture
tags:
- arch-lifecycle-automation
- adr
- architecture
---

## Context
We need to determine project and phase status from granular task states. How should rollup work?

Options:
1. Per-task only (no aggregation)
2. Per-phase only
3. Per-deliverable
4. Hierarchical (task → phase → project)

## Decision
Use hierarchical rollup: Task completion rolls up to phase progress, phase completion rolls up to project status.

Rollup rules:
- Phase progress = (done + skipped) / total tasks
- Phase status: pending → in-progress (first task starts) → done (all tasks done/skipped)
- Project status: draft → in-progress (first task starts) → completed (all phases done)

## Alternatives Considered
- Per-task only
- Per-phase only
- Per-deliverable

---
type: decisions
spec: arch-lifecycle-automation
timestamp: '2025-12-15T06:46:53.969419Z'
summary: Divergence Tracking with User Notification
phase: architecture
tags:
- arch-lifecycle-automation
- adr
- architecture
- ci-cd
---

## Context
Implementation often diverges from plans: tasks get added, skipped, or modified. How should we handle this?

Options:
1. Silently update the plan
2. Block divergence (force adherence to plan)
3. Track and flag for user review
4. Track and auto-approve
5. Track, flag, and allow user to approve/reject

## Decision
Track divergences in PROGRESS.md Divergence Log, notify user, and allow them to approve or flag for review. Divergences don't block progress but are explicitly recorded.

Divergence types: `added`, `skipped`, `modified`, `reordered`
Resolution states: `approved`, `flagged`, `pending-review`

## Alternatives Considered
- Silent updates
- Block divergence
- Track and auto-approve

---
type: decisions
spec: arch-lifecycle-automation
timestamp: '2025-12-15T06:46:54.022542Z'
summary: Use Opus 4.5 Model for `/arch:i`
phase: architecture
tags:
- arch-lifecycle-automation
- adr
- architecture
---

## Context
The existing `/arch` commands use a model tiering strategy:
- `/arch:p` (planning): Opus 4.5 (complex reasoning)
- `/arch:s` (status): Sonnet (simpler operations)
- `/arch:c` (close): Sonnet (simpler operations)

What model should `/arch:i` use?

## Decision
Use Opus 4.5 for `/arch:i` because it requires:
- Intelligent detection of task completion from implementation work
- Context synthesis across multiple planning documents
- Nuanced divergence detection and user communication
- Complex state management and rollup calculations

## Alternatives Considered
- Sonnet
- Hybrid (Sonnet + escalate to Opus)

---
type: decisions
spec: claude-spec-plugin
timestamp: '2025-12-15T06:46:54.116070Z'
summary: Custom Prompt Capture vs Claude Code Native Logs
phase: architecture
tags:
- claude-spec-plugin
- adr
- architecture
---

## Context
Claude Code may maintain internal session transcripts. The question was whether we could leverage those instead of maintaining a custom prompt capture system.

## Decision
Maintain **custom prompt capture system** within the plugin.

---
type: decisions
spec: claude-spec-plugin
timestamp: '2025-12-15T06:46:54.184620Z'
summary: Command Prefix Rename (/arch:* → /cs:*)
phase: architecture
tags:
- claude-spec-plugin
- adr
- architecture
---

## Context
The plugin needs a command prefix. Options were `/arch:*`, `/spec:*`, `/cs:*`, or `/cspec:*`.

## Decision
Use **`/cs:*`** prefix (short for claude-spec).

---
type: decisions
spec: claude-spec-plugin
timestamp: '2025-12-15T06:46:54.257856Z'
summary: No Legacy Aliases
phase: architecture
tags:
- claude-spec-plugin
- adr
- architecture
---

## Context
During migration, we could provide `/arch:*` aliases that redirect to `/cs:*` commands.

## Decision
**No aliases** - clean break from old commands.

---
type: decisions
spec: claude-spec-plugin
timestamp: '2025-12-15T06:46:54.315612Z'
summary: Project Directory Rename
phase: architecture
tags:
- claude-spec-plugin
- adr
- architecture
---

## Context
Projects were stored in `docs/architecture/active/`. With the rename, options were:
- Keep old location (backward compatible)
- Rename to `docs/spec/active/` (consistent branding)
- Use hidden `.claude-spec/` directory

## Decision
Rename to **`docs/spec/active/`** with one-time migration via `/cs:migrate`.

---
type: decisions
spec: claude-spec-plugin
timestamp: '2025-12-15T06:46:54.396268Z'
summary: Worktree Commands Structure
phase: architecture
tags:
- claude-spec-plugin
- adr
- architecture
- ci-cd
---

## Context
Worktree manager functionality could be exposed as:
- Skill triggers only ("spin up worktrees")
- Explicit commands (`/cs:wt:*`)
- Both

## Decision
**Both** - skill triggers AND explicit commands.

Commands:
- `/cs:wt:create` - Create worktrees with agents
- `/cs:wt:status` - View worktree status
- `/cs:wt:cleanup` - Clean up worktrees

---
type: decisions
spec: claude-spec-plugin
timestamp: '2025-12-15T06:46:54.530812Z'
summary: Hidden Prompt Log File
phase: architecture
tags:
- claude-spec-plugin
- adr
- architecture
---

## Context
Prompt log file naming options:
- `PROMPT_LOG.json` (visible, all caps)
- `prompts.json` (visible, lowercase)
- `.prompt-log.json` (hidden)

## Decision
Use **`.prompt-log.json`** (hidden file).
