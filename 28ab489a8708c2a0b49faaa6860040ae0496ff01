---
type: learnings
timestamp: '2025-12-25T16:12:05.974636+00:00'
summary: API error 400 with "unexpected tool_use_id" indicates conversation state
  corruption
---

API error 400 with "unexpected tool_use_id" indicates conversation state corruption
## Summary
Tool result blocks must reference tool_use blocks from the immediately preceding message. When this invariant is violated, the API rejects the request.

## Common Causes
- Interrupted responses during tool calls
- Context compaction mishandling tool call pairs
- Session resume with incomplete state

## Related Files
- commands/implement.md:1-1502 (command being invoked)

---
type: learnings
timestamp: '2025-12-25T16:17:41.680029+00:00'
summary: API error 400 with "unexpected tool_use_id" indicates conversation state
  corruption
---

API error 400 with "unexpected tool_use_id" indicates conversation state corruption
## Summary
Tool result blocks must reference tool_use blocks from the immediately preceding message. When this invariant is violated, the API rejects the request.

## Common Causes
- Interrupted responses during tool calls
- Context compaction mishandling tool call pairs
- Session resume with incomplete state

## Related Files
- commands/implement.md:1-1502 (command being invoked)
