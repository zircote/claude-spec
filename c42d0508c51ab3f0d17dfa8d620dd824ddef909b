---
type: learnings
timestamp: '2025-12-25T16:21:00.942700+00:00'
summary: API error 400 with "unexpected tool_use_id" indicates conversation state
  corruption
---

API error 400 with "unexpected tool_use_id" indicates conversation state corruption
## Summary
Tool result blocks must reference tool_use blocks from the immediately preceding message. When this invariant is violated, the API rejects the request.

## Common Causes
- Interrupted responses during tool calls
- Context compaction mishandling tool call pairs
- Session resume with incomplete state

## Related Files
- commands/implement.md:1-1502 (command being invoked)

---
type: learnings
timestamp: '2025-12-25T16:24:17.459782+00:00'
summary: API error 400 with "unexpected tool_use_id" indicates conversation state
  corruption
---

API error 400 with "unexpected tool_use_id" indicates conversation state corruption
## Summary
Tool result blocks must reference tool_use blocks from the immediately preceding message. When this invariant is violated, the API rejects the request.

## Common Causes
- Interrupted responses during tool calls
- Context compaction mishandling tool call pairs
- Session resume with incomplete state

## Related Files
- commands/implement.md:1-1502 (command being invoked)

---
type: learnings
timestamp: '2025-12-25T16:40:15.619456+00:00'
summary: The planning artifacts are preserved for future reference.
tags:
- auto-captured
- post-tool-use
- file:complete.md
---

The planning artifacts are preserved for future reference.
```

</close_out_protocol>

---
type: learnings
timestamp: '2025-12-25T16:43:45.982830+00:00'
summary: API error 400 with "unexpected tool_use_id" indicates conversation state
  corruption
---

API error 400 with "unexpected tool_use_id" indicates conversation state corruption
## Summary
Tool result blocks must reference tool_use blocks from the immediately preceding message. When this invariant is violated, the API rejects the request.

## Common Causes
- Interrupted responses during tool calls
- Context compaction mishandling tool call pairs
- Session resume with incomplete state

## Related Files
- commands/implement.md:1-1502 (command being invoked)
